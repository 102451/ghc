#!/bin/sh
#
# Running 'binary-dist' gives us a tree which
# isn't quite right for the purposes of creating
# a mingw/win32 install tree.  This script rejigs
# the tree.
#
# To use:
#
#   foo$ cd <top of fptools build tree>
#   foo$ make binary-dist Project=Ghc 
#   foo$ cd ghc-<version>
#   foo$ ../distrib/prep-bin-dist-mingw
#
export gcc_lib=c:/ghc/ghc-5.02.2/gcc-lib
export perl_dir=c:/ghc/ghc-5.02.2
export mingw_include=c:/ghc/ghc-5.02.2/include/mingw

# Play safe
if ! [ -d bin/i386-unknown-mingw32 ] ; then
  echo "Doesn't look as if I'm in the toplevel directory of a mingw tree"
  echo "Usage: cd ghc-<version> ; ../distrib/prep-bin-dist-mingw"
  exit 1;
fi;

echo "Removing configure script files...not needed"
rm -f config.guess config.sub configure configure.in mkdirhier
rm -f Makefile-bin.in Makefile.in aclocal.m4 install-sh

echo "rejig bin/"
mv bin/i386-unknown-mingw32/* bin/
rmdir bin/i386-unknown-mingw32
strip bin/ghc.exe

echo "rejig lib/"
mv lib/i386-unknown-mingw32/* .
rmdir lib/i386-unknown-mingw32
rmdir lib
mv ghc-asm.prl ghc-asm
mv ghc-split.prl ghc-split

echo "copy in gcc-lib/"
cp -Rf $gcc_lib .

echo "extra header files inside of include/"
mkdir include/mingw
cp -Rf $mingw_include include/


echo "copy in perl too"
cp ${perl_dir}/perl.exe .
cp ${perl_dir}/perl56.dll .
cp ${perl_dir}/gcc.exe .

# For reasons unknown, duplicate copies of misc package files in share/
# (leave them be for now.)

echo "formatting documentation"
cp README README.txt
mv share doc
cp ../ghc/docs/users_guide/users_guide.pdf doc/
cp ../hslibs/doc/hslibs.pdf doc/
#mkdir doc
#mkdir doc/user-guide
#cp -Rf html/* doc/user-guide/
#cp pdf/set.pdf doc/
#rm -rf html/
#rm -rf pdf/

